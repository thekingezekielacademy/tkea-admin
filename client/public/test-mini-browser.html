<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Browser Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>Mini Browser Compatibility Test</h1>
    
    <div id="results">
        <div class="status warning">Testing browser compatibility...</div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        // Test 1: Basic JavaScript
        addResult('âœ… JavaScript is working', 'success');

        // Test 2: Browser Detection
        const userAgent = navigator.userAgent;
        const isInstagram = /Instagram/i.test(userAgent);
        const isFacebook = /FBAN|FBAV|FBIOS/i.test(userAgent);
        const isMiniBrowser = isInstagram || isFacebook;

        addResult(`User Agent: ${userAgent}`, 'info');
        addResult(`Instagram Browser: ${isInstagram ? 'YES' : 'NO'}`, isInstagram ? 'warning' : 'success');
        addResult(`Facebook Browser: ${isFacebook ? 'YES' : 'NO'}`, isFacebook ? 'warning' : 'success');
        addResult(`Mini Browser: ${isMiniBrowser ? 'YES' : 'NO'}`, isMiniBrowser ? 'warning' : 'success');

        // Test 3: React Detection
        addResult(`React Available: ${typeof React !== 'undefined' ? 'YES' : 'NO'}`, typeof React !== 'undefined' ? 'success' : 'error');
        addResult(`ReactDOM Available: ${typeof ReactDOM !== 'undefined' ? 'YES' : 'NO'}`, typeof ReactDOM !== 'undefined' ? 'success' : 'error');

        // Test 4: Modern JavaScript Features
        const hasPromise = typeof Promise !== 'undefined';
        const hasFetch = typeof fetch !== 'undefined';
        const hasLocalStorage = typeof localStorage !== 'undefined';
        const hasServiceWorker = 'serviceWorker' in navigator;

        addResult(`Promise Support: ${hasPromise ? 'YES' : 'NO'}`, hasPromise ? 'success' : 'error');
        addResult(`Fetch Support: ${hasFetch ? 'YES' : 'NO'}`, hasFetch ? 'success' : 'error');
        addResult(`LocalStorage Support: ${hasLocalStorage ? 'YES' : 'NO'}`, hasLocalStorage ? 'success' : 'error');
        addResult(`Service Worker Support: ${hasServiceWorker ? 'YES' : 'NO'}`, hasServiceWorker ? 'success' : 'error');

        // Test 5: Check for our global variables
        setTimeout(() => {
            const polyfillsLoaded = window.__KEA_POLYFILLS_LOADED__;
            const hydrationStatus = window.__KEA_HYDRATION_STATUS__;
            const bootProgress = window.__KEA_BOOT_PROGRESS__;
            const bootMode = window.__KEA_BOOT_MODE__;

            addResult(`Polyfills Loaded: ${polyfillsLoaded ? 'YES' : 'NO'}`, polyfillsLoaded ? 'success' : 'error');
            addResult(`Hydration Status: ${hydrationStatus || 'NOT SET'}`, hydrationStatus === 'ok' ? 'success' : 'warning');
            addResult(`Boot Progress: ${bootProgress || 'NOT SET'}`, bootProgress ? 'success' : 'warning');
            addResult(`Boot Mode: ${bootMode || 'NOT SET'}`, bootMode ? 'success' : 'warning');

            // Test 6: Check if React app is actually running
            const rootElement = document.getElementById('root');
            if (rootElement) {
                addResult(`Root Element Found: YES`, 'success');
                addResult(`Root Element Children: ${rootElement.children.length}`, rootElement.children.length > 0 ? 'success' : 'warning');
                addResult(`Root Element InnerHTML Length: ${rootElement.innerHTML.length}`, rootElement.innerHTML.length > 0 ? 'success' : 'warning');
            } else {
                addResult(`Root Element Found: NO`, 'error');
            }
        }, 2000);

        // Test 7: Check for errors
        window.addEventListener('error', (e) => {
            addResult(`JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            addResult(`Promise Rejection: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>
