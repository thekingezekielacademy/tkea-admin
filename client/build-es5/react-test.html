<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React Test - Mini Browser</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4); 
            color: white; 
            padding: 20px; 
            text-align: center;
            min-height: 100vh;
            margin: 0;
        }
        .big { font-size: 48px; margin: 20px 0; }
        .medium { font-size: 24px; margin: 10px 0; }
        .small { font-size: 16px; margin: 5px 0; }
        .test-box { 
            background: rgba(255,255,255,0.2); 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0;
            border: 2px solid white;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold;
        }
        .success { background: rgba(40, 167, 69, 0.8); }
        .error { background: rgba(220, 53, 69, 0.8); }
        .warning { background: rgba(255, 193, 7, 0.8); color: #000; }
        .info { background: rgba(23, 162, 184, 0.8); }
        #react-root { 
            min-height: 200px; 
            border: 3px dashed white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin: 20px 0; 
            background: rgba(255,255,255,0.1); 
            border-radius: 10px;
        }
        button { 
            background: #007bff; 
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 18px; 
            margin: 10px;
        }
        button:hover { background: #0056b3; }
        .log { 
            background: rgba(0,0,0,0.3); 
            padding: 10px; 
            border-radius: 5px; 
            text-align: left; 
            font-family: monospace; 
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="big">‚öõÔ∏è REACT TEST - MINI BROWSER</div>
    <div class="medium">Testing React loading and mounting in mini browsers</div>
    
    <div class="test-box">
        <h2>üîç Browser Detection Results:</h2>
        <div id="browser-info"></div>
    </div>
    
    <div class="test-box">
        <h2>üì¶ React Loading Test:</h2>
        <button onclick="loadReact()">Load React from CDN</button>
        <button onclick="loadMainApp()">Load Main App Script</button>
        <div id="react-status" class="status info">Click buttons to test React loading</div>
        <div id="react-root">
            <div class="medium">React app will mount here...</div>
        </div>
    </div>
    
    <div class="test-box">
        <h2>üìù Console Log:</h2>
        <div id="console-log" class="log"></div>
    </div>
    
    <script>
        // Console logging
        const log = document.getElementById('console-log');
        const originalLog = console.log;
        const originalError = console.error;
        
        function addLog(message, type = 'log') {
            const div = document.createElement('div');
            div.style.color = type === 'error' ? '#ff6b6b' : '#4ecdc4';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }
        
        console.log = function(...args) {
            addLog(args.join(' '), 'log');
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog(args.join(' '), 'error');
            originalError.apply(console, args);
        };
        
        // Browser detection
        function detectBrowser() {
            const ua = navigator.userAgent || '';
            const isMobile = /Android|webos|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const isInApp = /FBAN|FBAV|FBIOS|Instagram|Line|Twitter|LinkedIn|WhatsApp|Telegram|wv\)/i.test(ua);
            const isSafari = /Safari/i.test(ua) && !/Chrome|CriOS|EdgA|Firefox|FxiOS|OPR|Vivaldi/i.test(ua);
            const isIOS = /iPad|iPhone|iPod/.test(ua);
            const isAndroid = /Android/i.test(ua);
            
            return {
                userAgent: ua,
                isMobile,
                isInApp,
                isSafari,
                isIOS,
                isAndroid,
                screenWidth: screen.width,
                screenHeight: screen.height,
                viewportWidth: window.innerWidth,
                viewportHeight: window.innerHeight
            };
        }
        
        function displayBrowserInfo() {
            const info = detectBrowser();
            const container = document.getElementById('browser-info');
            
            container.innerHTML = `
                <div class="small">üì± Mobile: ${info.isMobile ? '‚úÖ Yes' : '‚ùå No'}</div>
                <div class="small">üåê In-App Browser: ${info.isInApp ? '‚úÖ Yes' : '‚ùå No'}</div>
                <div class="small">üçé Safari: ${info.isSafari ? '‚úÖ Yes' : '‚ùå No'}</div>
                <div class="small">üì± iOS: ${info.isIOS ? '‚úÖ Yes' : '‚ùå No'}</div>
                <div class="small">ü§ñ Android: ${info.isAndroid ? '‚úÖ Yes' : '‚ùå No'}</div>
                <div class="small">üìè Screen: ${info.screenWidth}x${info.screenHeight}</div>
                <div class="small">üëÅÔ∏è Viewport: ${info.viewportWidth}x${info.viewportHeight}</div>
                <div class="small">üîó Hash: ${location.hash || '[empty]'}</div>
            `;
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('react-status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        function loadReact() {
            updateStatus('Loading React from CDN...', 'info');
            console.log('Loading React from CDN...');
            
            // Load React
            const reactScript = document.createElement('script');
            reactScript.src = 'https://unpkg.com/react@18/umd/react.production.min.js';
            reactScript.onload = function() {
                console.log('‚úÖ React loaded successfully');
                updateStatus('React loaded! Loading ReactDOM...', 'success');
                
                // Load ReactDOM
                const reactDOMScript = document.createElement('script');
                reactDOMScript.src = 'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js';
                reactDOMScript.onload = function() {
                    console.log('‚úÖ ReactDOM loaded successfully');
                    updateStatus('React and ReactDOM loaded! Testing mount...', 'success');
                    
                    // Test React mounting
                    try {
                        const root = ReactDOM.createRoot(document.getElementById('react-root'));
                        root.render(React.createElement('div', null,
                            React.createElement('h2', null, '‚úÖ React Mounted Successfully!'),
                            React.createElement('p', null, 'This is a React component rendered in mini browser'),
                            React.createElement('p', null, `Time: ${new Date().toLocaleTimeString()}`),
                            React.createElement('p', null, `Browser: ${navigator.userAgent.substring(0, 50)}...`)
                        ));
                        updateStatus('‚úÖ React mounted successfully in mini browser!', 'success');
                        console.log('‚úÖ React mounted successfully in mini browser!');
                    } catch (e) {
                        updateStatus('‚ùå React mount failed: ' + e.message, 'error');
                        console.error('‚ùå React mount failed:', e);
                    }
                };
                reactDOMScript.onerror = function() {
                    updateStatus('‚ùå ReactDOM failed to load', 'error');
                    console.error('‚ùå ReactDOM failed to load');
                };
                document.head.appendChild(reactDOMScript);
            };
            reactScript.onerror = function() {
                updateStatus('‚ùå React failed to load', 'error');
                console.error('‚ùå React failed to load');
            };
            document.head.appendChild(reactScript);
        }
        
        function loadMainApp() {
            updateStatus('Loading main app script...', 'info');
            console.log('Loading main app script...');
            
            const script = document.createElement('script');
            script.src = '/static/js/main.a37cd3c4.js';
            script.onload = function() {
                console.log('‚úÖ Main app script loaded');
                updateStatus('Main app script loaded! Checking for React...', 'success');
                
                // Wait longer for React to initialize and check multiple times
                let attempts = 0;
                const maxAttempts = 10;
                const checkInterval = 500; // Check every 500ms
                
                const checkForReact = () => {
                    attempts++;
                    console.log(`Checking for React availability (attempt ${attempts}/${maxAttempts})...`);
                    
                    if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined') {
                        console.log('‚úÖ React and ReactDOM available from main app');
                        updateStatus('React available from main app! Testing mount...', 'success');
                        
                        try {
                            const root = ReactDOM.createRoot(document.getElementById('react-root'));
                            root.render(React.createElement('div', null,
                                React.createElement('h2', null, '‚úÖ Main App React Mounted!'),
                                React.createElement('p', null, 'This is using the main app\'s React bundle'),
                                React.createElement('p', null, `Time: ${new Date().toLocaleTimeString()}`),
                                React.createElement('p', null, `Attempts: ${attempts}`)
                            ));
                            updateStatus('‚úÖ Main app React mounted successfully!', 'success');
                            console.log('‚úÖ Main app React mounted successfully!');
                        } catch (e) {
                            updateStatus('‚ùå Main app React mount failed: ' + e.message, 'error');
                            console.error('‚ùå Main app React mount failed:', e);
                        }
                    } else if (attempts < maxAttempts) {
                        console.log(`React not yet available, retrying in ${checkInterval}ms...`);
                        updateStatus(`Waiting for React... (${attempts}/${maxAttempts})`, 'warning');
                        setTimeout(checkForReact, checkInterval);
                    } else {
                        updateStatus('‚ùå React not available from main app after ' + maxAttempts + ' attempts', 'error');
                        console.error('‚ùå React not available from main app after ' + maxAttempts + ' attempts');
                    }
                };
                
                checkForReact();
            };
            script.onerror = function() {
                updateStatus('‚ùå Main app script failed to load', 'error');
                console.error('‚ùå Main app script failed to load');
            };
            document.head.appendChild(script);
        }
        
        // Initialize
        window.onload = function() {
            displayBrowserInfo();
            console.log('React test page loaded');
            console.log('Browser info:', detectBrowser());
        };
    </script>
</body>
</html>
