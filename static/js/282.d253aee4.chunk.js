"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[282],{8282:function(e,r,n){n.r(r),n.d(r,{CourseScheduler:function(){return l}});var t=n(1212),s=n(4765),c=n(467),o=n(3029),i=n(2901),a=n(2391),u=n(3846),l=function(){function e(){(0,o.A)(this,e),this.notificationService=void 0,this.checkInterval=null,this.notificationService=u.NotificationService.getInstance()}return(0,i.A)(e,[{key:"startScheduler",value:function(){var e=this;this.checkInterval&&clearInterval(this.checkInterval),this.checkInterval=setInterval(function(){e.checkScheduledCourses()},3e5),this.checkScheduledCourses()}},{key:"stopScheduler",value:function(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}},{key:"checkScheduledCourses",value:function(){var e=(0,c.A)((0,t.A)().m(function e(){var r,n,c,o,i,u,l,h,d;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=(new Date).toISOString(),e.n=1,a.N.from("courses").select("*").eq("is_scheduled",!0).eq("status","scheduled").lte("scheduled_for",r);case 1:if(n=e.v,c=n.data,!(o=n.error)){e.n=2;break}return console.error("Error checking scheduled courses:",o),e.a(2);case 2:if(!(c&&c.length>0)){e.n=9;break}console.log("Found ".concat(c.length," courses to publish")),i=(0,s.A)(c),e.p=3,i.s();case 4:if((u=i.n()).done){e.n=6;break}return l=u.value,e.n=5,this.publishCourse(l);case 5:e.n=4;break;case 6:e.n=8;break;case 7:e.p=7,h=e.v,i.e(h);case 8:return e.p=8,i.f(),e.f(8);case 9:return e.n=10,this.checkUpcomingCourses();case 10:e.n=12;break;case 11:e.p=11,d=e.v,console.error("Error in checkScheduledCourses:",d);case 12:return e.a(2)}},e,this,[[3,7,8,9],[0,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"publishCourse",value:function(){var e=(0,c.A)((0,t.A)().m(function e(r){var n,s,c;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a.N.from("courses").update({status:"published",is_scheduled:!1,scheduled_for:null}).eq("id",r.id);case 1:if(n=e.v,!(s=n.error)){e.n=2;break}return console.error("Error publishing course:",s),e.a(2);case 2:return console.log('Course "'.concat(r.title,'" has been published')),e.n=3,this.notifyCourseAvailable(r);case 3:e.n=5;break;case 4:e.p=4,c=e.v,console.error("Error publishing course:",c);case 5:return e.a(2)}},e,this,[[0,4]])}));return function(r){return e.apply(this,arguments)}}()},{key:"notifyCourseAvailable",value:function(){var e=(0,c.A)((0,t.A)().m(function e(r){var n;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!JSON.parse(localStorage.getItem("course_notifications")||"[]").includes(r.id)){e.n=1;break}return e.n=1,this.notificationService.sendCourseAvailableNotification(r.title,r.id);case 1:e.n=3;break;case 2:e.p=2,n=e.v,console.error("Error notifying course available:",n);case 3:return e.a(2)}},e,this,[[0,2]])}));return function(r){return e.apply(this,arguments)}}()},{key:"checkUpcomingCourses",value:function(){var e=(0,c.A)((0,t.A)().m(function e(){var r,n,c,o,i,u,l,h,d,f,v,p,k,b,g,S,A,m,y;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=new Date,n=new Date(r.getTime()+36e5),c=new Date(r.getTime()+864e5),e.n=1,a.N.from("courses").select("*").eq("is_scheduled",!0).eq("status","scheduled").gte("scheduled_for",r.toISOString()).lte("scheduled_for",n.toISOString());case 1:if(o=e.v,i=o.data,!(u=o.error)){e.n=2;break}console.error("Error checking courses in one hour:",u),e.n=9;break;case 2:if(!(i&&i.length>0)){e.n=9;break}l=(0,s.A)(i),e.p=3,l.s();case 4:if((h=l.n()).done){e.n=6;break}return d=h.value,e.n=5,this.sendCourseReminder(d,1);case 5:e.n=4;break;case 6:e.n=8;break;case 7:e.p=7,A=e.v,l.e(A);case 8:return e.p=8,l.f(),e.f(8);case 9:return e.n=10,a.N.from("courses").select("*").eq("is_scheduled",!0).eq("status","scheduled").gte("scheduled_for",r.toISOString()).lte("scheduled_for",c.toISOString()).gt("scheduled_for",n.toISOString());case 10:if(f=e.v,v=f.data,!(p=f.error)){e.n=11;break}console.error("Error checking courses in one day:",p),e.n=18;break;case 11:if(!(v&&v.length>0)){e.n=18;break}k=(0,s.A)(v),e.p=12,k.s();case 13:if((b=k.n()).done){e.n=15;break}return g=b.value,S=Math.floor((new Date(g.scheduled_for).getTime()-r.getTime())/36e5),e.n=14,this.sendCourseReminder(g,S);case 14:e.n=13;break;case 15:e.n=17;break;case 16:e.p=16,m=e.v,k.e(m);case 17:return e.p=17,k.f(),e.f(17);case 18:e.n=20;break;case 19:e.p=19,y=e.v,console.error("Error checking upcoming courses:",y);case 20:return e.a(2)}},e,this,[[12,16,17,18],[3,7,8,9],[0,19]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendCourseReminder",value:function(){var e=(0,c.A)((0,t.A)().m(function e(r,n){var s;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!JSON.parse(localStorage.getItem("course_notifications")||"[]").includes(r.id)){e.n=1;break}return e.n=1,this.notificationService.sendCourseReminderNotification(r.title,n,r.id);case 1:e.n=3;break;case 2:e.p=2,s=e.v,console.error("Error sending course reminder:",s);case 3:return e.a(2)}},e,this,[[0,2]])}));return function(r,n){return e.apply(this,arguments)}}()},{key:"notifyCourseScheduled",value:function(){var e=(0,c.A)((0,t.A)().m(function e(r,n,s){var c;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.notificationService.sendCourseScheduledNotification(r,n,s);case 1:e.n=3;break;case 2:e.p=2,c=e.v,console.error("Error notifying course scheduled:",c);case 3:return e.a(2)}},e,this,[[0,2]])}));return function(r,n,t){return e.apply(this,arguments)}}()},{key:"getScheduledCourses",value:function(){var e=(0,c.A)((0,t.A)().m(function e(){var r,n,s,c;return(0,t.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a.N.from("courses").select("*").eq("is_scheduled",!0).eq("status","scheduled").order("scheduled_for",{ascending:!0});case 1:if(r=e.v,n=r.data,!(s=r.error)){e.n=2;break}return console.error("Error fetching scheduled courses:",s),e.a(2,[]);case 2:return e.a(2,n||[]);case 3:return e.p=3,c=e.v,console.error("Error fetching scheduled courses:",c),e.a(2,[])}},e,null,[[0,3]])}));return function(){return e.apply(this,arguments)}}()}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}();l.instance=void 0}}]);
//# sourceMappingURL=282.d253aee4.chunk.js.map